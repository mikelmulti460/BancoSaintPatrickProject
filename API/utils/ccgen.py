import random
import re
from bank_accounts_api import models

def gen_card():
	visa_list=[485046, 499184, 467093, 473162, 485046, 434634, 415312, 432331, 438483, 440543, 426569, 412996, 483692, 413016, 451740, 430943, 484609, 426325, 447838, 472870, 497412, 447870, 410597, 425294, 481404, 477155, 472269, 494905, 429804, 414226, 465787, 461480, 443287, 450642, 471909, 482581, 411290, 410071, 478836, 406624, 476823, 456064, 482947, 464373, 469376, 474756, 481082, 408758, 491064, 420299, 417709, 422765, 410043, 492919, 472826, 467407, 464699, 477921, 416773, 444511, 456279, 418840, 457469, 433293, 418981, 460724, 473365, 498496, 438383, 471936, 453856, 472854, 436203, 470426, 403393, 466192, 473261, 461762, 443638, 483102, 436308, 442786, 414930, 403404, 439299, 410938, 458266, 464904, 400980, 448431, 429051, 400079, 426184, 443856, 439674, 458356, 420412, 416255, 400849, 488209]

	def luhn(n):
		r = [int(ch) for ch in str(n)][::-1]
		return (sum(r[0::2]) + sum(sum(divmod(d*2,10)) for d in r[1::2])) % 10 == 0

	new_card = random.choice(visa_list)
	new_card *=10**(16-len(str(new_card)))+random.choice(list(range(100)))

	valid = False
	while(luhn(new_card)==False and valid==False):
		new_card+=random.choice(list(range(10000)))
		cc2 = str(new_card)
		indices = [m.start() for m in re.finditer('0',cc2)]
		
		if len(indices) <= 2 and not True in [cc2[i] != cc2[i+1] for i in indices] and not models.Card.objects.filter(card_number=new_card).exists():
			valid = True
	return new_card



# data = json.loads('[ { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4850469315942698" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4991847449085361" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4670934131402084" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4731626880549639" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4850464378932637" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4346348380195469" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4153121006038419" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4323317613833078" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4384833289191571" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4405435375922383" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4265694226328898" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4129965052952241" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4836923071606409" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4130163338877294" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4517406803849790" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4309437118164593" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4846093067667613" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4263254925519594" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4478389509099547" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4728708328111357" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4974123521033344" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4478701512469253" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4105971865934176" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4252946022028840" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4814047242620929" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4771559162973261" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4722696821232802" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4949054758937125" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4298046187331539" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4142267215725348" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4657875439463947" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4614802504686170" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4432873356375691" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4506424360838141" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4719092486649636" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4825819550984387" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4112904193421344" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4100710627899508" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4788369590512611" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4066243902899045" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4768239042011088" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4560649199948371" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4829473863502746" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4643731713930886" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4693764420073137" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4747560521243165" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4810821138481453" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4087584786195256" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4910648657617640" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4202993315803241" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4177092383380439" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4227654282959645" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4100433842637781" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4929196176452155" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4728261910487595" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4674075755987210" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4646991886727033" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4779215863669821" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4167737265930956" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4445112540050687" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4562794570542324" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4188403647002338" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4574694013633001" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4332938513469579" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4189811778618996" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4607249398882078" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4733654094275559" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4984960492422255" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4383839735117632" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4719369749010784" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4538562186750735" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4728542503327482" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4362033952829633" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4704266672159744" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4033938085873622" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4661923612118104" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4732618048667212" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4617628911327638" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4436382236874366" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4831028213619081" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4363081458963272" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4427860855855536" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4149300828867539" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4034047046400886" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4392998769189013" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4109383556997858" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4582667076665011" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4649044525746266" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4009807137186046" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4484310227599313" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4290518769178528" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4000793990221048" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4261847115754400" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4438567749908903" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4396749633726563" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4583565584849987" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4204126067554815" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4162559450673851" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4008493766571757" } }, { "Tarjeta de Credito": { "Entidad Emisora": "Visa", "Numero": "4882096319859701" } } ]')
# for i in data:
# 	for j in i:
# 		vals=i[j]
# 		num = vals["Numero"]
# 		visa_list.append(int(num[0:6]))
